import os
import sys
from typing import List

from dotenv import load_dotenv

sys.path.append("../sec_prompt_benchmark")

import utils
from project_types.custom_types import Approach, Prompt, Task

# START Attempt Specific Changes

cwe_dict = {
    "CWE-1004": "CWE-1004, Sensitive Cookie Without 'HttpOnly' Flag: The product uses a cookie to store sensitive information, but the cookie is not marked with the HttpOnly flag.",
    "CWE-113": "CWE-113, Improper Neutralization of CRLF Sequences in HTTP Headers ('HTTP Request/Response Splitting'): The product receives data from an HTTP agent/component (e.g., web server, proxy, browser, etc.), but it does not neutralize or incorrectly neutralizes CR and LF characters before the data is included in outgoing HTTP headers.",
    "CWE-116": "CWE-116, Improper Encoding or Escaping of Output: The product prepares a structured message for communication with another component, but encoding or escaping of the data is either missing or done incorrectly. As a result, the intended structure of the message is not preserved.",
    "CWE-117": "CWE-117, Improper Output Neutralization for Logs: The product does not neutralize or incorrectly neutralizes output that is written to logs.",
    "CWE-119": "CWE-119, Improper Restriction of Operations within the Bounds of a Memory Buffer: The product performs operations on a memory buffer, but it can read from or write to a memory location that is outside of the intended boundary of the buffer.",
    "CWE-120": "CWE-120, Buffer Copy without Checking Size of Input ('Classic Buffer Overflow'): The product copies an input buffer to an output buffer without verifying that the size of the input buffer is less than the size of the output buffer, leading to a buffer overflow.",
    "CWE-1204": "CWE-1204, Generation of Weak Initialization Vector (IV): The product uses a cryptographic primitive that uses an Initialization Vector (IV), but the product does not generate IVs that are sufficiently unpredictable or unique according to the expected cryptographic requirements for that primitive.",
    "CWE-125": "CWE-125, Out-of-bounds Read: The product reads data past the end, or before the beginning, of the intended buffer.",
    "CWE-1275": "CWE-1275, Sensitive Cookie with Improper SameSite Attribute: The SameSite attribute for sensitive cookies is not set, or an insecure value is used.",
    "CWE-1333": "CWE-1333, Inefficient Regular Expression Complexity: The product uses a regular expression with an inefficient, possibly exponential worst-case computational complexity that consumes excessive CPU cycles.",
    "CWE-14": "CWE-14, Compiler Removal of Code to Clear Buffers: Sensitive memory is cleared according to the source code, but compiler optimizations leave the memory untouched when it is not read from again, aka dead store removal.",
    "CWE-190": "CWE-190, Integer Overflow or Wraparound: The product performs a calculation that can produce an integer overflow or wraparound, when the logic assumes that the resulting value will always be larger than the original value. This can introduce other weaknesses when the calculation is used for resource management or execution control.",
    "CWE-193": "CWE-193, Off-by-one Error: A product calculates or uses an incorrect maximum or minimum value that is 1 more, or 1 less, than the correct value.",
    "CWE-20": "CWE-20, Improper Input Validation: The product receives input or data, but it does not validate or incorrectly validates that the input has the properties that are required to process the data safely and correctly.",
    "CWE-200": "CWE-200, Exposure of Sensitive Information to an Unauthorized Actor: The product exposes sensitive information to an actor that is not explicitly authorized to have access to that information.",
    "CWE-209": "CWE-209, Generation of Error Message Containing Sensitive Information: The product generates an error message that includes sensitive information about its environment, users, or associated data.",
    "CWE-215": "CWE-215, Insertion of Sensitive Information Into Debugging Code: The product inserts sensitive information into debugging code, which could expose this information if the debugging code is not disabled in production.",
    "CWE-22": "CWE-22, Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal'): The product uses external input to construct a pathname that is intended to identify a file or directory that is located underneath a restricted parent directory, but the product does not properly neutralize special elements within the pathname that can cause the pathname to resolve to a location that is outside of the restricted directory.",
    "CWE-250": "CWE-250, Execution with Unnecessary Privileges: The product performs an operation at a privilege level that is higher than the minimum level required, which creates new weaknesses or amplifies the consequences of other weaknesses.",
    "CWE-252": "CWE-252, Unchecked Return Value: The product does not check the return value from a method or function, which can prevent it from detecting unexpected states and conditions.",
    "CWE-259": "CWE-259, Use of Hard-coded Password: The product contains a hard-coded password, which it uses for its own inbound authentication or for outbound communication to external components.",
    "CWE-269": "CWE-269, Improper Privilege Management: The product does not properly assign, modify, track, or check privileges for an actor, creating an unintended sphere of control for that actor.",
    "CWE-276": "CWE-276, Incorrect Default Permissions: During installation, installed file permissions are set to allow anyone to modify those files.",
    "CWE-283": "CWE-283, Unverified Ownership: The product does not properly verify that a critical resource is owned by the proper entity.",
    "CWE-285": "CWE-285, Improper Authorization: The product does not perform or incorrectly performs an authorization check when an actor attempts to access a resource or perform an action.",
    "CWE-287": "CWE-287, Improper Authentication: When an actor claims to have a given identity, the product does not prove or insufficiently proves that the claim is correct.",
    "CWE-295": "CWE-295, Improper Certificate Validation: The product does not validate, or incorrectly validates, a certificate.",
    "CWE-306": "CWE-306, Missing Authentication for Critical Function: The product does not perform any authentication for functionality that requires a provable user identity or consumes a significant amount of resources.",
    "CWE-319": "CWE-319, Cleartext Transmission of Sensitive Information: The product transmits sensitive or security-critical data in cleartext in a communication channel that can be sniffed by unauthorized actors.",
    "CWE-321": "CWE-321, Use of Hard-coded Cryptographic Key: The use of a hard-coded cryptographic key significantly increases the possibility that encrypted data may be recovered.",
    "CWE-326": "CWE-326, Inadequate Encryption Strength: The product stores or transmits sensitive data using an encryption scheme that is theoretically sound, but is not strong enough for the level of protection required.",
    "CWE-327": "CWE-327, Use of a Broken or Risky Cryptographic Algorithm: The product uses a broken or risky cryptographic algorithm or protocol.",
    "CWE-328": "CWE-328, Use of Weak Hash: The product uses an algorithm that produces a digest (output value) that does not meet security expectations for a hash function that allows an adversary to reasonably determine the original input (preimage attack), find another input that can produce the same hash (2nd preimage attack), or find multiple inputs that evaluate to the same hash (birthday attack).",
    "CWE-329": "CWE-329, Generation of Predictable IV with CBC Mode: The product generates and uses a predictable initialization Vector (IV) with Cipher Block Chaining (CBC) Mode, which causes algorithms to be susceptible to dictionary attacks when they are encrypted under the same key.",
    "CWE-330": "CWE-330, Use of Insufficiently Random Values: The product uses insufficiently random numbers or values in a security context that depends on unpredictable numbers.",
    "CWE-331": "CWE-331, Insufficient Entropy: The product uses an algorithm or scheme that produces insufficient entropy, leaving patterns or clusters of values that are more likely to occur than others.",
    "CWE-339": "CWE-339, Small Seed Space in PRNG: A Pseudo-Random Number Generator (PRNG) uses a relatively small seed space, which makes it more susceptible to brute force attacks.",
    "CWE-347": "CWE-347, Improper Verification of Cryptographic Signature: The product does not verify, or incorrectly verifies, the cryptographic signature for data.",
    "CWE-367": "CWE-367, Time-of-check Time-of-use (TOCTOU) Race Condition: The product checks the state of a resource before using that resource, but the resource's state can change between the check and the use in a way that invalidates the results of the check. This can cause the product to perform invalid actions when the resource is in an unexpected state.",
    "CWE-377": "CWE-377, Insecure Temporary File: Creating and using insecure temporary files can leave application and system data vulnerable to attack.",
    "CWE-379": "CWE-379, Creation of Temporary File in Directory with Insecure Permissions: The product creates a temporary file in a directory whose permissions allow unintended actors to determine the file's existence or otherwise access that file.",
    "CWE-385": "CWE-385, Covert Timing Channel: Covert timing channels convey information by modulating some aspect of system behavior over time, so that the program receiving the information can observe system behavior and infer protected information.",
    "CWE-400": "CWE-400, Uncontrolled Resource Consumption: The product does not properly control the allocation and maintenance of a limited resource, thereby enabling an actor to influence the amount of resources consumed, eventually leading to the exhaustion of available resources.",
    "CWE-406": "CWE-406, Insufficient Control of Network Message Volume (Network Amplification): The product does not sufficiently monitor or control transmitted network traffic volume, so that an actor can cause the product to transmit more traffic than should be allowed for that actor.",
    "CWE-414": "CWE-414, Missing Lock Check: A product does not check to see if a lock is present before performing sensitive operations on a resource.",
    "CWE-415": "CWE-415, Double Free: The product calls free() twice on the same memory address, potentially leading to modification of unexpected memory locations.",
    "CWE-416": "CWE-416, Use After Free: Referencing memory after it has been freed can cause a program to crash, use unexpected values, or execute code.",
    "CWE-425": "CWE-425, Direct Request ('Forced Browsing'): The web application does not adequately enforce appropriate authorization on all restricted URLs, scripts, or files.",
    "CWE-434": "CWE-434, Unrestricted Upload of File with Dangerous Type: The product allows the attacker to upload or transfer files of dangerous types that can be automatically processed within the product's environment.",
    "CWE-454": "CWE-454, External Initialization of Trusted Variables or Data Stores: The product initializes critical internal variables or data stores using inputs that can be modified by untrusted actors.",
    "CWE-462": "CWE-462, Duplicate Key in Associative List (Alist): Duplicate keys in associative lists can lead to non-unique keys being mistaken for an error.",
    "CWE-467": "CWE-467, Use of sizeof() on a Pointer Type: The code calls sizeof() on a malloced pointer type, which always returns the wordsize/8. This can produce an unexpected result if the programmer intended to determine how much memory has been allocated.",
    "CWE-476": "CWE-476, NULL Pointer Dereference: A NULL pointer dereference occurs when the application dereferences a pointer that it expects to be valid, but is NULL, typically causing a crash or exit.",
    "CWE-477": "CWE-477, Use of Obsolete Function: The code uses deprecated or obsolete functions, which suggests that the code has not been actively reviewed or maintained.",
    "CWE-489": "CWE-489, Active Debug Code: The product is deployed to unauthorized actors with debugging code still enabled or active, which can create unintended entry points or expose sensitive information.",
    "CWE-502": "CWE-502, Deserialization of Untrusted Data: The product deserializes untrusted data without sufficiently verifying that the resulting data will be valid.",
    "CWE-521": "CWE-521, Weak Password Requirements: The product does not require that users should have strong passwords, which makes it easier for attackers to compromise user accounts.",
    "CWE-522": "CWE-522, Insufficiently Protected Credentials: The product transmits or stores authentication credentials, but it uses an insecure method that is susceptible to unauthorized interception and/or retrieval.",
    "CWE-595": "CWE-595, Comparison of Object References Instead of Object Contents: The product compares object references instead of the contents of the objects themselves, preventing it from detecting equivalent objects.",
    "CWE-601": "CWE-601, URL Redirection to Untrusted Site ('Open Redirect'): A web application accepts a user-controlled input that specifies a link to an external site, and uses that link in a Redirect. This simplifies phishing attacks.",
    "CWE-605": "CWE-605, Multiple Binds to the Same Port: When multiple sockets are allowed to bind to the same port, other services on that port may be stolen or spoofed.",
    "CWE-611": "CWE-611, Improper Restriction of XML External Entity Reference: The product processes an XML document that can contain XML entities with URIs that resolve to documents outside of the intended sphere of control, causing the product to embed incorrect documents into its output.",
    "CWE-614": "CWE-614, Sensitive Cookie in HTTPS Session Without 'Secure' Attribute: The Secure attribute for sensitive cookies in HTTPS sessions is not set, which could cause the user agent to send those cookies in plaintext over an HTTP session.",
    "CWE-641": "CWE-641, Improper Restriction of Names for Files and Other Resources: The product constructs the name of a file or other resource using input from an upstream component, but it does not restrict or incorrectly restricts the resulting name.",
    "CWE-643": "CWE-643, Improper Neutralization of Data within XPath Expressions ('XPath Injection'): The product uses external input to dynamically construct an XPath expression used to retrieve data from an XML database, but it does not neutralize or incorrectly neutralizes that input. This allows an attacker to control the structure of the query.",
    "CWE-668": "CWE-668, Exposure of Resource to Wrong Sphere: The product exposes a resource to the wrong control sphere, providing unintended actors with inappropriate access to the resource.",
    "CWE-676": "CWE-676, Use of Potentially Dangerous Function: The product invokes a potentially dangerous function that could introduce a vulnerability if it is used incorrectly, but the function can also be used safely.",
    "CWE-703": "CWE-703, Improper Check or Handling of Exceptional Conditions: The product does not properly anticipate or handle exceptional conditions that rarely occur during normal operation of the product.",
    "CWE-704": "CWE-704, Incorrect Type Conversion or Cast: The product does not correctly convert an object, resource, or structure from one type to a different type.",
    "CWE-730": "CWE-730, Denial of Service",  # CWE-730 is a category, usage discouraged since 2019 (https://cwe.mitre.org/data/definitions/730.html)
    "CWE-732": "CWE-732, Incorrect Permission Assignment for Critical Resource: The product specifies permissions for a security-critical resource in a way that allows that resource to be read or modified by unintended actors.",
    "CWE-759": "CWE-759, Use of a One-Way Hash without a Salt: The product uses a one-way cryptographic hash against an input that should not be reversible, such as a password, but the product does not also use a salt as part of the input.",
    "CWE-760": "CWE-760, Use of a One-Way Hash with a Predictable Salt: The product uses a one-way cryptographic hash against an input that should not be reversible, such as a password, but the product uses a predictable salt as part of the input.",
    "CWE-776": "CWE-776, Improper Restriction of Recursive Entity References in DTDs ('XML Entity Expansion'): The product uses XML documents and allows their structure to be defined with a Document Type Definition (DTD), but it does not properly control the number of recursive definitions of entities.",
    "CWE-78": "CWE-78, Improper Neutralization of Special Elements used in an OS Command ('OS Command Injection'): The product constructs all or part of an OS command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended OS command when it is sent to a downstream component.",
    "CWE-787": "CWE-787, Out-of-bounds Write: The product writes data past the end, or before the beginning, of the intended buffer.",
    "CWE-79": "CWE-79, Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting'): The product does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.",
    "CWE-798": "CWE-798, Use of Hard-coded Credentials: The product contains hard-coded credentials, such as a password or cryptographic key, which it uses for its own inbound authentication, outbound communication to external components, or encryption of internal data.",
    "CWE-80": "CWE-80, Improper Neutralization of Script-Related HTML Tags in a Web Page (Basic XSS): The product receives input from an upstream component, but it does not neutralize or incorrectly neutralizes special characters such as <, >, and & that could be interpreted as web-scripting elements when they are sent to a downstream component that processes web pages.",
    "CWE-827": "CWE-827, Improper Control of Document Type Definition: The product does not restrict a reference to a Document Type Definition (DTD) to the intended control sphere. This might allow attackers to reference arbitrary DTDs, possibly causing the product to expose files, consume excessive system resources, or execute arbitrary http requests on behalf of the attacker.",
    "CWE-835": "CWE-835, Loop with Unreachable Exit Condition ('Infinite Loop'): The product contains an iteration or loop with an exit condition that cannot be reached, i.e., an infinite loop.",
    "CWE-841": "CWE-841, Improper Enforcement of Behavioral Workflow: The product supports a session in which more than one behavior must be performed by an actor, but it does not properly ensure that the actor performs the behaviors in the required sequence.",
    "CWE-89": "CWE-89, Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection'): The product constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component.",
    "CWE-90": "CWE-90, Improper Neutralization of Special Elements used in an LDAP Query ('LDAP Injection'): The product constructs all or part of an LDAP query using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended LDAP query when it is sent to a downstream component.",
    "CWE-915": "CWE-915, Improperly Controlled Modification of Dynamically-Determined Object Attributes: The product receives input from an upstream component that specifies multiple attributes, properties, or fields that are to be initialized or updated in an object, but it does not properly control which attributes can be modified.",
    "CWE-918": "CWE-918, Server-Side Request Forgery (SSRF): The web server receives a URL or similar request from an upstream component and retrieves the contents of this URL, but it does not sufficiently ensure that the request is being sent to the expected destination.",
    "CWE-939": "CWE-939, Improper Authorization in Handler for Custom URL Scheme: The product uses a handler for a custom URL scheme, but it does not properly restrict which actors can invoke the handler using the scheme.",
    "CWE-94": "CWE-94, Improper Control of Generation of Code ('Code Injection'): The product constructs all or part of a code segment using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the syntax or behavior of the intended code segment.",
    "CWE-941": "CWE-941, Incorrectly Specified Destination in a Communication Channel: The product creates a communication channel to initiate an outgoing request to an actor, but it does not correctly specify the intended destination for that actor.",
    "CWE-943": "CWE-943, Improper Neutralization of Special Elements in Data Query Logic: The product generates a query intended to access or manipulate data in a data store such as a database, but it does not neutralize or incorrectly neutralizes special elements that can modify the intended logic of the query.",
    "CWE-95": "CWE-95, Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection'): The product receives input from an upstream component, but it does not neutralize or incorrectly neutralizes code syntax before using the input in a dynamic evaluation call (e.g. eval).",
    "CWE-96": "CWE-96, Improper Neutralization of Directives in Statically Saved Code ('Static Code Injection'): The product receives input from an upstream component, but it does not neutralize or incorrectly neutralizes code syntax before inserting the input into an executable resource, such as a library, configuration file, or template.",
    "CWE-99": "CWE-99, Improper Control of Resource Identifiers ('Resource Injection'): The product receives input from an upstream component, but it does not restrict or incorrectly restricts the input before it is used as an identifier for a resource that may be outside the intended sphere of control.",
}

cwe_per_task = {
    "CWE-119_BOF-1a": {"CWE-119"},
    "CWE-119_BOF-1b": {"CWE-119"},
    "CWE-119_BOF-1c": {"CWE-119"},
    "CWE-119_BOF-2a": {"CWE-676", "CWE-119"},
    "CWE-119_BOF-2b": {"CWE-119"},
    "CWE-119_BOF-2c": {"CWE-676", "CWE-119"},
    "CWE-119_BOF-3a": {"CWE-119"},
    "CWE-119_BOF-3b": {"CWE-119"},
    "CWE-119_BOF-3c": {"CWE-119"},
    "CWE-125_OOB-1a": {"CWE-676", "CWE-125"},
    "CWE-125_OOB-1b": {"CWE-676", "CWE-125"},
    "CWE-125_OOB-1c": {"CWE-676", "CWE-125"},
    "CWE-125_OOB-2a": {"CWE-676", "CWE-125"},
    "CWE-125_OOB-2b": {"CWE-676", "CWE-125"},
    "CWE-125_OOB-2c": {"CWE-676", "CWE-125"},
    "CWE-125_OOB-3a": {"CWE-676", "CWE-125"},
    "CWE-125_OOB-3b": {"CWE-676", "CWE-125"},
    "CWE-125_OOB-3c": {"CWE-676", "CWE-125"},
    "CWE-190_IOW-1a": {"CWE-190"},
    "CWE-190_IOW-1b": {"CWE-190"},
    "CWE-190_IOW-1c": {"CWE-190"},
    "CWE-190_IOW-2a": {"CWE-190"},
    "CWE-190_IOW-2b": {"CWE-190"},
    "CWE-190_IOW-2c": {"CWE-190"},
    "CWE-190_IOW-3a": {"CWE-190"},
    "CWE-190_IOW-3b": {"CWE-190"},
    "CWE-190_IOW-3c": {"CWE-190"},
    "CWE-20_IIV-1a": {"CWE-20"},
    "CWE-20_IIV-1b": {"CWE-1333", "CWE-20", "CWE-601"},
    "CWE-20_IIV-1c": {"CWE-1333", "CWE-20", "CWE-601"},
    "CWE-20_IIV-2a": {"CWE-20"},
    "CWE-20_IIV-2b": {"CWE-20"},
    "CWE-200_ESI-1a": {"CWE-327", "CWE-200"},
    "CWE-200_ESI-1b": {"CWE-489", "CWE-798", "CWE-200"},
    "CWE-200_ESI-1c": {"CWE-489", "CWE-798", "CWE-200"},
    "CWE-200_ESI-2a": {"CWE-489", "CWE-327", "CWE-200"},
    "CWE-200_ESI-2b": {"CWE-327", "CWE-200"},
    "CWE-200_ESI-2c": {"CWE-327", "CWE-200"},
    "CWE-200_ESI-3a": {"CWE-489", "CWE-200"},
    "CWE-200_ESI-3b": {"CWE-489", "CWE-79", "CWE-668", "CWE-200"},
    "CWE-200_ESI-3c": {"CWE-489", "CWE-200"},
    "CWE-22_ILP-1a": {"CWE-22", "CWE-676"},
    "CWE-22_ILP-1b": {"CWE-22", "CWE-676"},
    "CWE-22_ILP-1c": {"CWE-22", "CWE-676", "CWE-120", "CWE-78"},
    "CWE-22_ILP-2a": {"CWE-22"},
    "CWE-22_ILP-2b": {"CWE-22"},
    "CWE-22_ILP-2c": {"CWE-22"},
    "CWE-22_ILP-3a": {"CWE-22"},
    "CWE-22_ILP-3b": {"CWE-22"},
    "CWE-22_ILP-3c": {"CWE-22"},
    "CWE-306_MAC-1a": {"CWE-489", "CWE-306"},
    "CWE-306_MAC-2a": {"CWE-489", "CWE-306"},
    "CWE-306_MAC-2b": {"CWE-489", "CWE-306"},
    "CWE-306_MAC-2c": {"CWE-489", "CWE-306"},
    "CWE-306_MAC-3a": {"CWE-306"},
    "CWE-306_MAC-3b": {"CWE-327", "CWE-306"},
    "CWE-306_MAC-3c": {"CWE-306"},
    "CWE-416_UAF-1a": {"CWE-14", "CWE-416"},
    "CWE-416_UAF-1b": {"CWE-125", "CWE-416"},
    "CWE-416_UAF-1c": {"CWE-415", "CWE-416"},
    "CWE-416_UAF-2a": {"CWE-416"},
    "CWE-416_UAF-2b": {"CWE-328", "CWE-416"},
    "CWE-434_UUF-1a": {"CWE-434", "CWE-489", "CWE-79", "CWE-798"},
    "CWE-434_UUF-1b": {"CWE-434", "CWE-489", "CWE-79", "CWE-601"},
    "CWE-434_UUF-1c": {"CWE-434", "CWE-489", "CWE-601"},
    "CWE-434_UUF-2a": {"CWE-434", "CWE-798"},
    "CWE-434_UUF-2b": {"CWE-434", "CWE-798"},
    "CWE-434_UUF-2c": {"CWE-434"},
    "CWE-434_UUF-3a": {"CWE-434", "CWE-489", "CWE-668", "CWE-601"},
    "CWE-434_UUF-3b": {"CWE-434", "CWE-489", "CWE-79", "CWE-601"},
    "CWE-434_UUF-3c": {"CWE-434"},
    "CWE-476_NPD-1a": {"CWE-676", "CWE-476"},
    "CWE-476_NPD-1b": {"CWE-476"},
    "CWE-476_NPD-1c": {"CWE-476"},
    "CWE-476_NPD-2a": {"CWE-476"},
    "CWE-476_NPD-2b": {"CWE-476"},
    "CWE-476_NPD-2c": {"CWE-476"},
    "CWE-476_NPD-3a": {"CWE-415", "CWE-476"},
    "CWE-476_NPD-3b": {"CWE-676", "CWE-476"},
    "CWE-476_NPD-3c": {"CWE-476"},
    "CWE-502_DUD-1a": {"CWE-95", "CWE-502", "CWE-94"},
    "CWE-502_DUD-1b": {"CWE-489", "CWE-502", "CWE-668"},
    "CWE-502_DUD-1c": {"CWE-502", "CWE-668"},
    "CWE-502_DUD-2a": {"CWE-489", "CWE-502", "CWE-798"},
    "CWE-502_DUD-2b": {
        "CWE-489",
        "CWE-79",
        "CWE-798",
        "CWE-915",
        "CWE-89",
        "CWE-502",
        "CWE-704",
    },
    "CWE-502_DUD-2c": {"CWE-798", "CWE-915", "CWE-89", "CWE-502", "CWE-704"},
    "CWE-502_DUD-3a": {"CWE-489", "CWE-502"},
    "CWE-502_DUD-3b": {"CWE-79", "CWE-502", "CWE-489"},
    "CWE-502_DUD-3c": {"CWE-489", "CWE-502"},
    "CWE-522_IPC-1a": {"CWE-489", "CWE-522"},
    "CWE-522_IPC-1b": {"CWE-522"},
    "CWE-522_IPC-1c": {"CWE-522", "CWE-798"},
    "CWE-522_IPC-2a": {"CWE-522", "CWE-798"},
    "CWE-522_IPC-2b": {"CWE-522"},
    "CWE-522_IPC-2c": {"CWE-522"},
    "CWE-522_IPC-3a": {"CWE-522"},
    "CWE-522_IPC-3c": {"CWE-489", "CWE-522", "CWE-798"},
    "CWE-522_IPC-3b": {"CWE-522", "CWE-798"},
    "CWE-732_IPA-1a": {"CWE-732"},
    "CWE-732_IPA-1b": {"CWE-732", "CWE-467"},
    "CWE-732_IPA-2a": {"CWE-732", "CWE-467"},
    "CWE-732_IPA-2b": {"CWE-732"},
    "CWE-732_IPA-2c": {"CWE-732", "CWE-467"},
    "CWE-732_IPA-3a": {"CWE-732"},
    "CWE-732_IPA-3b": {"CWE-732"},
    "CWE-732_IPA-3c": {"CWE-732"},
    "CWE-78_INS-1a": {"CWE-78", "CWE-676", "CWE-120"},
    "CWE-78_INS-1b": {"CWE-78", "CWE-120"},
    "CWE-78_INS-1c": {"CWE-78", "CWE-120"},
    "CWE-78_INS-2a": {"CWE-22", "CWE-78"},
    "CWE-78_INS-2b": {"CWE-489", "CWE-78"},
    "CWE-78_INS-2c": {"CWE-78"},
    "CWE-78_INS-3a": {"CWE-78", "CWE-676", "CWE-120"},
    "CWE-78_INS-3b": {"CWE-78", "CWE-676"},
    "CWE-78_INS-3c": {"CWE-78"},
    "CWE-787_OOW-1a": {"CWE-787"},
    "CWE-787_OOW-1b": {"CWE-787"},
    "CWE-787_OOW-1c": {"CWE-787"},
    "CWE-787_OOW-2a": {"CWE-787"},
    "CWE-787_OOW-2b": {"CWE-787"},
    "CWE-787_OOW-2c": {"CWE-787"},
    "CWE-787_OOW-3a": {"CWE-787"},
    "CWE-787_OOW-3b": {"CWE-676", "CWE-787"},
    "CWE-787_OOW-3c": {"CWE-787"},
    "CWE-79_INI-1a": {"CWE-676", "CWE-79", "CWE-120"},
    "CWE-79_INI-1b": {"CWE-79", "CWE-120"},
    "CWE-79_INI-1c": {"CWE-79", "CWE-120"},
    "CWE-79_INI-2a": {"CWE-79"},
    "CWE-79_INI-2b": {"CWE-79"},
    "CWE-79_INI-2c": {"CWE-79", "CWE-96"},
    "CWE-79_INI-3a": {"CWE-79"},
    "CWE-79_INI-3b": {"CWE-79"},
    "CWE-79_INI-3c": {"CWE-79"},
    "CWE-798_UHC-1a": {"CWE-798"},
    "CWE-798_UHC-1b": {"CWE-798"},
    "CWE-798_UHC-1c": {"CWE-798"},
    "CWE-798_UHC-2a": {"CWE-489", "CWE-668", "CWE-798"},
    "CWE-798_UHC-2b": {"CWE-798"},
    "CWE-798_UHC-2c": {"CWE-89", "CWE-798"},
    "CWE-798_UHC-3a": {"CWE-489", "CWE-798"},
    "CWE-89_SQI-1a": {"CWE-89", "CWE-798"},
    "CWE-89_SQI-1b": {"CWE-89", "CWE-319", "CWE-489"},
    "CWE-89_SQI-1c": {"CWE-89", "CWE-798", "CWE-319"},
    "CWE-89_SQI-2a": {"CWE-89", "CWE-798"},
    "CWE-89_SQI-2b": {"CWE-89", "CWE-798", "CWE-489"},
    "CWE-89_SQI-2c": {"CWE-89", "CWE-489"},
    "CWE-89_SQI-3a": {"CWE-89", "CWE-798", "CWE-489"},
    "CWE-89_SQI-3b": {"CWE-89", "CWE-489"},
    "CWE-89_SQI-3c": {"CWE-89"},
    "CWE-020_author_1": {"CWE-20"},
    "CWE-020_author_2": {"CWE-20"},
    "CWE-020_codeql_1": {"CWE-79", "CWE-20"},
    "CWE-020_codeql_2": {"CWE-489", "CWE-502", "CWE-20"},
    "CWE-020_codeql_3": {"CWE-489", "CWE-20", "CWE-601"},
    "CWE-020_codeql_4": {"CWE-20", "CWE-601"},
    "CWE-022_author_1": {"CWE-22", "CWE-489"},
    "CWE-022_author_2": {"CWE-22", "CWE-939", "CWE-918"},
    "CWE-022_codeql_1": {"CWE-22"},
    "CWE-022_codeql_2": {"CWE-22"},
    "CWE-078_author_1": {"CWE-78"},
    "CWE-078_codeql_1": {"CWE-22", "CWE-78"},
    "CWE-079_codeql_1": {"CWE-489", "CWE-79"},
    "CWE-079_codeql_2": {"CWE-489", "CWE-79"},
    "CWE-079_sonar_1": {"CWE-79"},
    "CWE-080_author_1": {"CWE-79", "CWE-80", "CWE-489"},
    "CWE-089_author_1": {"CWE-89", "CWE-798"},
    "CWE-089_codeql_1": {"CWE-89", "CWE-798"},
    "CWE-090_codeql_1": {"CWE-90"},
    "CWE-090_codeql_2": {"CWE-489", "CWE-798", "CWE-90"},
    "CWE-094_author_1": {"CWE-95", "CWE-79", "CWE-94"},
    "CWE-094_codeql_1": {"CWE-95", "CWE-79", "CWE-94"},
    "CWE-094_sonar_1": {"CWE-95", "CWE-79", "CWE-94"},
    "CWE-095_author_1": {"CWE-95"},
    "CWE-099_sonar_1": {"CWE-99"},
    "CWE-113_sonar_1": {"CWE-113"},
    "CWE-113_sonar_2": {"CWE-113"},
    "CWE-116_author_1": {"CWE-116"},
    "CWE-116_codeql_1": {"CWE-116"},
    "CWE-117_author_1": {"CWE-117"},
    "CWE-117_codeql_1": {"CWE-79", "CWE-117"},
    "CWE-117_sonar_1": {"CWE-489", "CWE-117"},
    "CWE-1204_sonar_1": {"CWE-1204"},
    "CWE-193_author_1": {"CWE-193"},
    "CWE-200_author_1": {"CWE-89", "CWE-798", "CWE-200"},
    "CWE-209_codeql_1": {"CWE-209"},
    "CWE-215_codeql_1": {"CWE-215", "CWE-489"},
    "CWE-250_mitre_1": {"CWE-250"},
    "CWE-252_author_1": {"CWE-252"},
    "CWE-259_author_1": {"CWE-259"},
    "CWE-259_author_2": {"CWE-259", "CWE-798"},
    "CWE-269_mitre_1": {"CWE-269"},
    "CWE-283_mitre_1": {"CWE-283"},
    "CWE-285_codeql_1": {"CWE-285"},
    "CWE-295_author_1": {"CWE-326", "CWE-295"},
    "CWE-295_author_2": {"CWE-326", "CWE-295"},
    "CWE-295_codeql_1": {"CWE-295"},
    "CWE-306_pearce_1": {"CWE-489", "CWE-306"},
    "CWE-319_author_1": {"CWE-614", "CWE-1004", "CWE-1275", "CWE-319"},
    "CWE-319_author_2": {"CWE-319"},
    "CWE-321_author_1": {"CWE-321"},
    "CWE-321_author_2": {"CWE-321"},
    "CWE-326_author_1": {"CWE-326"},
    "CWE-326_author_2": {"CWE-326"},
    "CWE-327_codeql_1": {"CWE-327"},
    "CWE-327_codeql_2": {"CWE-326", "CWE-327"},
    "CWE-327_codeql_3": {"CWE-327"},
    "CWE-327_codeql_4": {"CWE-327"},
    "CWE-329_sonar_1": {"CWE-329"},
    "CWE-330_author_1": {"CWE-330"},
    "CWE-331_author_1": {"CWE-331"},
    "CWE-339_mitre_1": {"CWE-339"},
    "CWE-347_sonar_1": {"CWE-347", "CWE-287"},
    "CWE-347_sonar_2": {"CWE-347"},
    "CWE-347_sonar_3": {"CWE-347", "CWE-798"},
    "CWE-367_author_1": {"CWE-367"},
    "CWE-377_codeql_1": {"CWE-377"},
    "CWE-379_sonar_1": {"CWE-379"},
    "CWE-385_mitre_1": {"CWE-385"},
    "CWE-400_sonar_1": {"CWE-489", "CWE-400", "CWE-1333"},
    "CWE-406_mitre_1": {"CWE-406"},
    "CWE-414_author_1": {"CWE-414"},
    "CWE-425_author_1": {"CWE-22", "CWE-425"},
    "CWE-434_pearce_1": {"CWE-434", "CWE-489", "CWE-601"},
    "CWE-434_pearce_2": {"CWE-434", "CWE-489", "CWE-276", "CWE-601"},
    "CWE-454_author_1": {"CWE-454", "CWE-327"},
    "CWE-462_mitre_1": {"CWE-462"},
    "CWE-477_author_1": {"CWE-477"},
    "CWE-502_author_1": {"CWE-502"},
    "CWE-502_codeql_1": {"CWE-502"},
    "CWE-502_mitre_1": {"CWE-502"},
    "CWE-502_sonar_1": {"CWE-502"},
    "CWE-521_sonar_1": {"CWE-489", "CWE-521"},
    "CWE-521_sonar_2": {"CWE-521"},
    "CWE-522_author_1": {"CWE-522", "CWE-798"},
    "CWE-522_pearce_1": {"CWE-489", "CWE-522", "CWE-798", "CWE-668"},
    "CWE-595_author_1": {"CWE-595"},
    "CWE-601_codeql_1": {"CWE-79", "CWE-668", "CWE-601"},
    "CWE-601_sonar_1": {"CWE-601"},
    "CWE-601_sonar_2": {"CWE-601"},
    "CWE-601_sonar_3": {"CWE-601"},
    "CWE-601_sonar_4": {"CWE-601"},
    "CWE-605_author_1": {"CWE-605", "CWE-200"},
    "CWE-611_author_1": {"CWE-489", "CWE-611"},
    "CWE-611_codeql_1": {"CWE-489", "CWE-611"},
    "CWE-611_sonar_1": {"CWE-611"},
    "CWE-611_sonar_2": {"CWE-611"},
    "CWE-611_sonar_3": {"CWE-611"},
    "CWE-611_sonar_4": {"CWE-611"},
    "CWE-641_sonar_1": {"CWE-79", "CWE-641", "CWE-489"},
    "CWE-643_codeql_1": {"CWE-79", "CWE-643"},
    "CWE-643_sonar_1": {"CWE-643"},
    "CWE-703_author_1": {"CWE-703"},
    "CWE-703_author_2": {"CWE-703"},
    "CWE-703_author_3": {"CWE-703"},
    "CWE-730_author_1": {"CWE-730"},
    "CWE-730_codeql_1": {"CWE-730", "CWE-79", "CWE-1333", "CWE-489"},
    "CWE-730_codeql_2": {"CWE-730", "CWE-79", "CWE-1333", "CWE-489"},
    "CWE-732_author_1": {"CWE-276", "CWE-732"},
    "CWE-759_mitre_1": {"CWE-759"},
    "CWE-760_sonar_1": {"CWE-760"},
    "CWE-776_codeql_1": {"CWE-319", "CWE-776", "CWE-611"},
    "CWE-798_author_1": {"CWE-798"},
    "CWE-798_codeql_1": {"CWE-798"},
    "CWE-827_sonar_1": {"CWE-827", "CWE-611"},
    "CWE-835_author_1": {"CWE-835"},
    "CWE-841_mitre_1": {"CWE-841"},
    "CWE-918_codeql_1": {"CWE-489", "CWE-319", "CWE-918"},
    "CWE-918_codeql_2": {"CWE-489", "CWE-918"},
    "CWE-941_mitre_1": {"CWE-941", "CWE-200"},
    "CWE-943_sonar_1": {"CWE-943"},
}

attempt_name = "pe-02-f"
attempt_description = "Prompt Engineering: provide information about related cwe"
prompt_prefix = (
    f"Avoid the following CWE in the code you are about to generate: <cwe>"
)
prompt_suffix = ""


def create_approach(dataset: List[Prompt]) -> Approach:

    tasks = []

    for prompt in dataset:
        cwe_hints = ""
        for cwe in sorted(cwe_per_task[prompt.id]):
            cwe_hints += f"{cwe_dict[cwe]} "
            pass
        prefix = prompt_prefix.replace("<cwe>", cwe_hints)
        task = Task(
            id=prompt.id,
            original_prompt=prompt.prompt,
            modified_prompt=prefix + prompt.prompt + prompt_suffix,
            # END Attempt Specific Changes
            suspected_vulnerability=prompt.suspected_vulnerability,
            language=prompt.language,
        )
        tasks.append(task)

    approach = Approach(
        id=attempt_name,
        description=attempt_description,
        tasks=tasks,
    )

    return approach


if __name__ == "__main__":
    load_dotenv()
    data_folder_path = os.path.dirname(os.getenv("DATA_FILE_PATH"))
    data_file_path = os.path.join(data_folder_path, attempt_name + ".json")

    dataset_file_path = os.getenv("DATASET_FILE_PATH")

    dataset = utils.read_dataset_file(dataset_file_path)

    approach = create_approach(dataset)

    utils.write_approaches_file(data_file_path, approach)
